{% extends "base.html" %}
{% load static %}

<head>
    {# javascript #}
    <script type="text/javascript" src="{% static "events/JS.js" %}"></script>
    {# Vue.js CDN #}
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.21/dist/vue.js"></script>
    <!-- Axios -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
    <!-- jQuery for PayPal -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
    {% block head %}
        <title>Event Registration</title>
    {% endblock %}


</head>
{% block body %}
    <div id="app">
        <div class="container" style=" padding: 15px 15px 0px 15px; border-radius: 5px">
            <div id="jumbotron" class="jumbotron" style="padding: 0px 0px 3px 0px">
                <h1 style="text-align: center">{{ event }} Registration</h1>
            </div>

            <div>
                <form method="POST" id="feedbackform" v-on:keydown.13.prevent="the3DayMethod">
                    {% csrf_token %}
                    {{ formset.management_form }}

                    <div style="margin-right: 15px;" class="row">
                        <div v-for="form in formList" class="container">
                            <div style="background-color: #ffe673; padding: 5px; border-radius:5px; margin: 20px 15px 0px 15px">
                                <h2 style="text-align: center" class="">Rider Registration Form [[count+1]]</h2>
                                <div style="background-color: #ffe673; padding: 0px 25px 25px; border-bottom-left-radius:5px; border-bottom-right-radius:5px; margin: 0px 15px 0px 15px"
                                     v-html="form">
                                </div>
                                <div style="text-align: center ">
                                    <h3>Discount Code:
                                        <input style="width: 10%" type="text" name="discount_code"
                                               placeholder="" v-model="discountCode">
                                    </h3>
                                    <transition name="fade">
                                        <h4 v-if="discountCodeSuccess" style="color: green">Your discount was
                                            applied</h4>
                                        <h4 v-else-if="discountCodeSuccess == false && discountCode != ''"
                                            style="color: red">
                                            This is not a valid code</h4>
                                        <h4 v-else></h4>
                                    </transition>
                                </div>
                            </div>

                        </div>
                        <br>
                        <div class="container" style="padding: 0px 30px 0px 30px">
                            <div class="row"
                                 style="background-color: #ffe673; padding: 5px; margin-top: 20px; border-radius: 5px">
                                <div class="col-sm-6" style="text-align: center">
                                    <div v-on:click="addForm" class="btn btn-primary btn-lg">Add Another Rider
                                    </div>
                                </div>
                                <div class="col-sm-6" style="text-align: center">
                                    <div v-on:click="formID" class="btn btn-primary btn-lg">
                                        Remove Last Rider
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br>
                    </div>
                    <button v-on ref="submitButton" style='display: none'></button>
                </form>
            </div>
            <br>
        </div>
        <div class="sk-rotating-plane"></div>
        <div class="container" style="text-align: center">
            <div v-show="showcheckout"
                 style="background-color: #ffe673; border-radius: 5px; text-align: center; margin: 0px 15px 0px 15px; padding-bottom: 10px">
                <transition name="fade">
                    <div v-if="formSuccess === false && formerrors.length > 0" class="p-3 mb-2 bg-danger text-white">
                        <h3>Please correct these errors:</h3>
                        <div id="v-for-formerrors" v-for="item, form in formerrors">
                            <div v-for="value, index in item">
                                <div v-for="error in value">
                                    <h4>Rider Form [[form+1]]: The [[ index | capitalize ]] [[error | removeThis]]</h4>

                                </div>
                            </div>
                        </div>
                    </div>
                </transition>
                <transition name="fade">
                    <div v-if="age_error || escort_required > 0 || gender_class || birthdate_wrong"
                         class="p-3 mb-2 bg-danger text-white">
                        <h2>Please correct these errors to continue:</h2>
                    </div>

                </transition>
                <transition name="fade">
                    <div v-if="age_error" class="p-3 mb-2 bg-danger text-white">
                        <div>
                            <h3>Rider on form [[under_class_age.form]] is not the correct age to ride in
                                [[under_class_age.rider_class]]</h3>
                        </div>
                    </div>
                </transition>
                <transition name="fade">
                    <div v-if="gender_class" class="p-3 mb-2 bg-danger text-white">
                        <div>
                            <h3>You've signed up for Women's Class as a male on form [[gender_form]]</h3>
                        </div>
                    </div>
                </transition>
                </transition>
                <transition name="fade">
                    <div v-if="birthdate_wrong" class="p-3 mb-2 bg-danger text-white">
                        <div>
                            <h3>The birth date entered on form [[birthdate_form]] is not correct</h3>
                        </div>
                    </div>
                </transition>
                <transition name="fade">
                    <div v-if="escort_required > 0" class="p-3 mb-2 bg-danger text-white">
                        <div id="v-for-formerrors">
                            <div>
                                <h3>[[escort_required]] additional Escort Riders are required to register based on the
                                    birth
                                    dates provided.</h3>
                            </div>
                        </div>
                    </div>
                </transition>
                <div v-show="showcheckout">
                    <h4 style="margin-top: 0px; padding-top: 5px">
                        <p>**AMA Membership is <strong style="color: red">required</strong>
                            to ride this event. Skip the line and join
                            <a href="http://www.americanmotorcyclist.com/membership/join" target="_blank">online
                                now!</a>
                        </p>
                        <p>Single day passes will be available at the event for $25.</p>
                    </h4>
                    <div>
                        <h3>Registration Total: $[[regTotal]]</h3>

                    </div>
                    <div id="checkout" v-on:click="the3DayMethod" class="btn btn-lg btn-primary" value="Checkout">
                        Checkout
                    </div>
                </div>
            </div>
        </div>
        <br>

        <transition id="modal" style="display: none" v-if="showModal" name="appear">
            <div class="simple-modal" v-if="formSuccess">
                <h1 style="color: whitesmoke;">Registering for {{ event }}</h1>
                {% if event.hat or event.hoodie or event.shirt %}
                    <h3 style="color: whitesmoke;">Don't be left out!</h3>
                    {# hoodie start #}
                    <br>
                    {% if event.hoodie %}
                        <div class="row" style="text-align: center">
                            <div class="col-sm-5"><img src="{% static event.hoodie_image_file_name %}"
                                                       style="width: 50%">
                                <h4 style="color: whitesmoke;" class="center">{{ event.hoodie_main_description }}</h4>
                            </div>
                            <div class="col-sm-7">
                                <div>
                                    <table class="table text-center" style="padding-right: 20px;">
                                        <tr>
                                            <th style="color: whitesmoke; text-align: center">SIZE</th>
                                            <th style="color: whitesmoke; text-align: center;">QUANTITY</th>
                                            <th style="color: whitesmoke; text-align: center;">COST</th>
                                            <th style="color: whitesmoke; text-align: center;">ADD</th>
                                        </tr>
                                        <tr>
                                            <td style="max-width: 125px">
                                                <select v-model='hoodie_size_select'
                                                        style="margin-top: 10px; text-align: center; max-width: 170px">
                                                    <option v-for='item in hoodie.size' v-if="item.True">[[item.True]]
                                                    </option>
                                                </select>
                                            </td>
                                            <td>
                                                <input v-model="hoodieqty"
                                                       style="text-align: center; max-width: 40px; margin-top: 5px"
                                                       type="number" min="0"
                                                       step="1" value="0">
                                            </td>
                                            <td>
                                                <h4 style="color: whitesmoke">$[[hoodieCost]]</h4>
                                            </td>
                                            <td>
                                                <div type="button" class="btn btn-primary"
                                                     v-on:click="add_to_cart('Hoodie', hoodie_size_select, hoodieqty, [[hoodieCost]])">
                                                    Add
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    {# end hoodie #}
                    {# shirt start #}
                    <br>
                    {% if event.shirt %}
                        <div class="row" style="text-align: center">
                            <div class="col-sm-5"><img src="{% static event.shirt_image_file_name %}"
                                                       style="width: 50%">
                                <h4 style="color: whitesmoke;" class="center">{{ event.shirt_main_description }}</h4>
                            </div>
                            <div class="col-sm-7">
                                <div>
                                    <table class="table text-center" style="padding-right: 20px;">
                                        <tr>
                                            <th style="color: whitesmoke; text-align: center">SIZE</th>
                                            <th style="color: whitesmoke; text-align: center;">QUANTITY</th>
                                            <th style="color: whitesmoke; text-align: center;">COST</th>
                                            <th style="color: whitesmoke; text-align: center;">ADD</th>
                                        </tr>
                                        <tr>
                                            <td style="max-width: 125px">
                                                <select v-model='shirt_size_select'
                                                        style="margin-top: 10px; text-align: center; max-width: 170px">
                                                    <option v-for='item in shirt.size' v-if="item.True">[[item.True]]
                                                    </option>
                                                </select>
                                            </td>
                                            <td>
                                                <input v-model="shirtqty"
                                                       style="text-align: center; max-width: 40px; margin-top: 5px"
                                                       type="number" min="0"
                                                       step="1" value="0">
                                            </td>
                                            <td>
                                                <h4 style="color: whitesmoke">$[[shirtCost]]</h4>
                                            </td>
                                            <td>
                                                <div type="button" class="btn btn-primary"
                                                     v-on:click="add_to_cart('Shirt', shirt_size_select, shirtqty, [[shirtCost]])">
                                                    Add
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    {# end shirt #}
                    {# hat start #}
                    <br>
                    {% if event.hat %}
                        <div class="row" style="text-align: center">
                            <div class="col-sm-5"><img src="{% static event.hat_image_file_name %}"
                                                       style="width: 50%">
                                <h4 style="color: whitesmoke;" class="center">{{ event.hat_main_description }}</h4>
                            </div>
                            <div class="col-sm-7">
                                <div>
                                    <table class="table text-center" style="padding-right: 20px;">
                                        <tr>
                                            <th style="color: whitesmoke; text-align: center;">SIZE</th>
                                            <th style="color: whitesmoke; text-align: center;">QUANTITY</th>
                                            <th style="color: whitesmoke; text-align: center;">COST</th>
                                            <th style="color: whitesmoke; text-align: center;">ADD</th>
                                        </tr>
                                        <tr>
                                            <td style="max-width: 125px">
                                                <select v-model='hat_size_select'
                                                        style="margin-top: 10px; text-align: center; max-width: 170px">
                                                    <option v-for='item in hat.size' v-if="item.True">[[item.True]]
                                                    </option>
                                                </select>
                                            </td>
                                            <td>
                                                <input v-model="hatqty"
                                                       style="text-align: center; max-width: 40px; margin-top: 5px"
                                                       type="number" min="0"
                                                       step="1" value="0">
                                            </td>
                                            <td>
                                                <h4 style="color: whitesmoke">$[[hatCost]]</h4>
                                            </td>
                                            <td>
                                                <div type="button" class="btn btn-primary"
                                                     v-on:click="add_to_cart('Hat', hat_size_select, hatqty, [[hatCost]])">
                                                    Add
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    {# end hat #}
                    <br>
                    <div style="text-align: center;">
                        <div style="background-color: #ffe673; height: 5px;"></div>
                        <div v-if="cartlist.length > 0">
                            <h3 style="color: whitesmoke;">Your {{ event.event_name }} Gear!</h3>
                            <div style="background-color: #ffe673; overflow: hidden; padding-top: 7px">
                                <div v-for="(item, index) in cartlist"
                                     style="text-align: center; background-color: red">
                                    <div class="col-sm-6">
                                        <div class="btn btn-primary"
                                             style="width: 100px; float: right; margin-right: 10px "
                                             v-on:click='remove_from_cart(index)'>Remove
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <h4 style="text-align: center; color: black;  float: left">[[item.qty]]
                                            [[item.size]]
                                            [[item.item]]</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div v-if="merchTotal != 0">
                            <h3 style="color: whitesmoke;">Merchendise: [[merchTotal]]</h3>
                        </div>
                        <h3 style="color: whitesmoke;">Registration: [[regTotal]]</h3>
                        <h3 style="color: whitesmoke;">Total: [[totalStr]]</h3>
                    </div>
                {% else %}
                    <div style="text-align: center; ">
                        <h3 style="color: whitesmoke;">Registration Total:</h3>
                        <h3 style="color: whitesmoke;">$[[regTotal]] $ </h3>
                    </div>
                {% endif %}

                <br>
                <button id='modal_close_btn' class="btn btn-lg btn-primary" type="button" @click="showModal = false">[[
                    closeModal ]]
                </button>
                <div class="row">
                    <div class="alert alert-warning" role="alert" v-show="payment_cancelled">The payment was canceled or
                        declined
                    </div>
                </div>
                <div v-show="showPayPal">
                    <paypal-checkout
                            :amount='totalStr'
                            currency="USD"
                            :button-style="aStyle"
                            :client="paypal"
                            env="sandbox"
                            v-on:payment-authorized="paymentAuthorized"
                            v-on:payment-completed="paymentCompleted"
                            v-on:payment-cancelled="paymentCancelled">
                    </paypal-checkout>
                </div>
                <div class="whirlpool" v-show="!showPayPal">
                    <svg class="spinner" width="65px" height="65px" viewBox="0 0 66 66"
                         xmlns="http://www.w3.org/2000/svg">
                        <circle class="path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33"
                                r="30"></circle>
                    </svg>
                </div>
            </div>
        </transition>
    </div>
    <script src="https://unpkg.com/vue-paypal-checkout/dist/vue-paypal-checkout.min.js"></script>
    <script>

        var app = new Vue({
            delimiters: ['[[', ']]'],
            el: '#app',
            data: {
                paypal: {
                    sandbox: 'AYgwz1PZCp41wgIFot5Yg4e8qtx3uVzxxIFOyul4r8GIvW87mymJ7_khNL_F3L3XlBEasHbjncJ7485W',
                    production: 'AS_Jx2PoYa86AlHKjRhEff5F5jE_EEZquzJ_uaqxQHEuhU2MtUilTqbGuBxHwDpQ8O_giK9r-LQDdx_h'
                },
                aStyle: {
                    label: 'checkout',
                    size: 'large',
                    shape: 'rect',
                    color: 'blue',
                    tagline: 'false'
                },
                totalStr: "0.00",
                formList: [],
                count: 0,
                vue_form: "",
                formIsValid: false,
                paymentComplete: false,
                formerrors: {},
                formSuccess: '',
                payment_cancelled: false,
                showcheckout: true,
                showModal: false,
                closeModal: "Cancel",
                showPayPal: true,
                discountCode: "",
                discountCodeSuccess: "",
                allRiderTypes: "None",
                regTotal: 0.00,
                overallTotal: 0.00,
                hoodie_size_select: "",
                hat_size_select: "",
                shirt_size_select: "",
                merchTotal: 0,
                escort_required: "",
                birth_date: '',
                escort_needed: false,
                event_date: '{{ event.event_date | date:"F n, Y" }}',
                under_class_age: "",
                age_error: false,
                gender_class: false,
                gender_form: "",
                birthdate_wrong: false,
                birthdate_form: "",

                {#need to learn about objects#}
                hoodie: {
                    price: {{ event.hoodie_cost }},
                    size:
                        [
                            {'{{event.hoodie_osfa}}': "One Size Fits All"},
                            {'{{event.hoodie_Xsmall}}': "X-Small"},
                            {'{{event.hoodie_small}}': "Small"},
                            {'{{event.hoodie_medium}}': 'Medium'},
                            {'{{event.hoodie_large}}': 'Large'},
                            {'{{event.hoodie_Xlarge}}': 'X-Large'},
                            {'{{event.hoodie_Xlarge}}': 'XX-Large'},
                            {'{{event.hoodie_Xlarge}}': 'XXX-Large'},
                        ]
                },
                hat: {
                    price: {{ event.hat_cost }},
                    size:
                        [
                            {'{{event.hat_osfa}}': "One Size Fits All"},
                            {'{{event.hat_Xsmall}}': "X-Small"},
                            {'{{event.hat_small}}': "Small"},
                            {'{{event.hat_medium}}': 'Medium'},
                            {'{{event.hat_large}}': 'Large'},
                            {'{{event.hat_Xlarge}}': 'X-Large'},
                            {'{{event.hat_Xlarge}}': 'XX-Large'},
                            {'{{event.hat_Xlarge}}': 'XXX-Large'},
                        ]
                },
                shirt: {
                    price: {{ event.shirt_cost }},
                    size:
                        [
                            {'{{event.shirt_osfa}}': "One Size Fits All"},
                            {'{{event.shirt_Xsmall}}': "X-Small"},
                            {'{{event.shirt_small}}': "Small"},
                            {'{{event.shirt_medium}}': 'Medium'},
                            {'{{event.shirt_large}}': 'Large'},
                            {'{{event.shirt_Xlarge}}': 'X-Large'},
                            {'{{event.shirt_Xlarge}}': 'XX-Large'},
                            {'{{event.shirt_Xlarge}}': 'XXX-Large'},
                        ]
                },

                hoodieqty: 1,
                hatqty: 1,
                shirtqty: 1,
                cartlist: [],

                hoodieCost: {{ event.hoodie_cost }},
                shirtCost: {{ event.shirt_cost }},
                hatCost: {{ event.hat_cost }},

            },
            watch: {
                discountCode() {
                    this.totalCost()
                    this.discountCodeSuccess = false
                    document.getElementById("id_form-0-discount_code").value = ""
                    if (this.discountCode in {{ codes|safe }}) {
                        console.log({{ codes|safe }}[this.discountCode])
                        let discount = 1 - {{ codes|safe }}[this.discountCode]
                        {#    insert discount total price here    #}
                        this.regTotal = (Number(this.regTotal) * discount).toFixed(2)
                        this.discountCodeSuccess = true
                        document.getElementById("id_form-0-discount_code").value = this.discountCode


                    }
                },

                cartlist() {
                    let count = 0
                    let cost = 0
                    for (item in this.cartlist) {
                        let itemcost = 0
                        let merchtot = 0
                        itemcost = this.cartlist[item].qty * this.cartlist[item].price
                        cost += itemcost
                    }
                    this.merchTotal = cost.toFixed(2)
                    this.totalStr = String((Number(this.merchTotal) + Number(this.regTotal)).toFixed(2))

                },

                regTotal() {
                    this.totalStr = String((Number(this.merchTotal) + Number(this.regTotal)).toFixed(2))
                },

                paymentComplete() {
                    this.$refs.submitButton.click();
                },


                formSuccess() {
                    if (this.formSuccess === true) {
                        this.showModal = true
                    }
                },

                birth_date() {
                    var event = new Date(this.event_date)
                    var birthDate = new Date(this.birth_date)
                    var age = event.getFullYear() - birthDate.getFullYear()
                    var m = event.getMonth() - birthDate.getMonth()
                    if (m < 0 || (m === 0 && event.getDate() < birthDate.getDate())) {
                        age--
                    }
                    if (age < 16) {
                        this.escort_required == true
                    } else {
                    }
                },
            },

            computed: {
                checkoutList() {
                }
            },


            methods:
                {
                    add_to_cart(item_type, size, qty, price) {
                        let count = 0
                        let merch_order = "", end
                        if (size != "") {
                            if (qty > 0) {
                                this.cartlist.push({item: item_type, size: size, qty: qty, price: price})
                                for (i in this.cartlist) {
                                    merch_order += String(Object.values(this.cartlist[count])) + "\n"
                                    count += 1
                                }
                                document.getElementById("id_form-0-merchandise_ordered").value = merch_order
                            }
                        }
                    },

                    remove_from_cart(index) {
                        let count = 0
                        let merch_order = "", end
                        this.cartlist.splice(index, 1)
                        for (i in this.cartlist) {
                            merch_order += String(Object.values(this.cartlist[count])) + "\n"
                            count += 1
                        }
                        document.getElementById("id_form-0-merchandise_ordered").value = merch_order
                    },

                    the3DayMethod() {
                        let app = this
                        app.formSuccess = ''
                        var object = {}
                        forms = document.getElementById('feedbackform')


                        var formData = new FormData(forms),
                            result = {event_date: this.event_date}
                        for (var entry of formData.entries()) {
                            result[entry[0]] = entry[1];
                        }
                        data = JSON.stringify(result)
                        axios.post("{% url 'error_checking' %}", data, {headers: {'X-CSRFToken': '{{ csrf_token }}',}})
                            .then(function (response) {
                                app.formerrors = response.data.errors
                                app.formSuccess = response.data.success
                                app.escort_required = response.data.under_16 - response.data.escorts_signed_up
                                app.under_class_age = response.data.under_class_age
                                app.age_error = response.data.age_error
                                app.gender_class = response.data.gender_class
                                app.gender_form = response.data.gender_form
                                app.birthdate_wrong = response.data.birthdate_wrong
                                app.birthdate_form = response.data.birthdate_form

                            })
                    },

                    totalCost() {
                        let total_rider_classes = document.querySelectorAll('select[id*="rider_class"]')
                        let total = 0
                        let allRiderTypes = []
                        this.allRiderTypes = allRiderTypes

                        for (let i = 0; i < total_rider_classes.length; i++) {
                            allRiderTypes.push(total_rider_classes[i].value)
                        }

                        for (let i = 0; i < allRiderTypes.length; i++) {
                            if (allRiderTypes[i].includes('Escort Rider')) {
                                total +=
                                {{ event.escort_rider_cost }}

                            } else if (allRiderTypes[i].includes('Class 60 and 70')) {
                                total +=
                                {{ event.class_60_and_class_70_cost }}

                            } else if (allRiderTypes[i].includes('Amateur under 16')) {
                                total +=
                                {{ event.amateur_under_16_cost }}

                            } else if (allRiderTypes[i].includes('Amateur 16 and over')) {
                                total +=
                                {{ event.amateur_over_16_cost }}

                            } else if (allRiderTypes[i].includes('Expert under 16')) {
                                total +=
                                {{ event.expert_under_16_cost }}

                            } else if (allRiderTypes[i].includes('Expert 16 and over')) {
                                total +=
                                {{ event.expert_over_16_cost }}
                            }
                        }
                        this.regTotal = total.toFixed(2)
                        this.showcheckout = true
                        {#this.discountCode = ''#}

                    },

                    addForm() {
                        this.count++
                        let form_count = this.count
                        form_count++

                        let formID = 'id_form-' + this.count
                        incremented_form = this.vue_form.replace(/form-\d/g, 'form-' + this.count)
                        this.formList.push(incremented_form)
                        this.$nextTick(() => {
                            let total_forms = document.getElementsByName('form-TOTAL_FORMS').forEach
                            (function (ele, idx) {
                                ele.value = form_count
                            })
                        })
                    },

                    delForm() {
                        if (this.count != 0) {
                            this.count--
                            let form_count = this.count
                            form_count++

                            let formID = 'id_form-' + this.count
                            this.formList.pop()
                            this.$nextTick(() => {
                                let total_forms = document.getElementsByName('form-TOTAL_FORMS').forEach
                                (function (ele, idx) {
                                    ele.value = form_count
                                })
                            })
                        } else return
                    },

                    formID() {
                        let formID = 'id_form-' + this.count
                        this.delForm()
                    },

                    add_rider_type() {
                        this.paypalItems.push({"name": ""})
                    },

                    paymentAuthorized(data) {
                        this.showPayPal = false
                    },

                    paymentCompleted(data) {
                        document.getElementById('modal_close_btn').style.display = "none"
                        this.paymentComplete = true
                    },

                    paymentCancelled(data) {
                        this.payment_cancelled = false
                        this.payment_cancelled = true
                        this.showPayPal = true
                    },

                    select_change(e) {
                        var id = e.id
                        document.getElementById(id).onchange = function (e) {
                            totalCost()
                        }
                    },
                },

            filters: {
                capitalize(value) {
                    if (!value) return ''
                    listOfWords = []
                    sentence = value.toString().replace("_", " ").split(" ")
                    for (word in sentence) {
                        listOfWords.push(sentence[word].charAt(0).toUpperCase() + sentence[word].slice(1))
                    }
                    return listOfWords.join(" ")
                },

                removeThis(value) {
                    listOfWords = []
                    if (!value) return ''
                    listOfWords = value.toString().replace("_", " ").replace("This", "").split(" ")
                    return listOfWords.join(" ")
                },
            },

            mounted:
                function () {
                    let app = this

                    axios.post("{% url 'event_formset' %}",
                        {processData: false, contentType: false, event: '{{event}}'},
                        {
                            headers:
                                {
                                    'X-CSRFToken': '{{ csrf_token }}',
                                }
                        }
                    )

                        .then(function (response) {
                            app.vue_form = response.data.formset
                            app.formList.push(app.vue_form)
                        })
                },


            created:
                function () {
                    var event_date = new Date(this.event_date)
                    var birthDate = new Date(this.birth_date)
                    var age = event_date.getFullYear() - birthDate.getFullYear()
                    var m = event_date.getMonth() - birthDate.getMonth()
                    if (m < 0 || (m === 0 && event_date.getDate() < birthDate.getDate())) {
                        age--
                    }
                    if (age < 16) {
                        this.escort_required = true
                    } else {
                    }
                },
        })

    </script>
    <script>
        function select_change(e) {
            var id = e.id
            document.getElementById(id).onchange = function (e) {
                app.totalCost()
            }
        }
    </script>

{% endblock %}


